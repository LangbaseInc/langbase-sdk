import { generateMetadata } from '@/lib/generate-metadata';
import { LanguageProvider, SimpleLanguageToggle, LanguageContent } from '@/components/LanguageToggle';
export const metadata = generateMetadata({
    title: 'Run Pipe Agent Streaming',
    description: `An example of running a pipe agent streaming.`,
    section: 'Examples',
    slug: '/examples/pipe-agent/run-pipe-agent-streaming'
});

# Run Pipe Agent Streaming

This example demonstrates how to run a pipe agent with streaming response.

<LanguageProvider defaultLanguage='typescript'>

<RunExample api="/docs/api/pipe"

	title="Run Pipe Agent Streaming Example"
	output={`
Stream started.

An AI engineer is a professional who specializes in the development and implementation of artificial intelligence (AI) systems and applications. They work at the intersection of software engineering, data science, and machine learning, using their skills to create algorithms and models that enable machines to perform tasks that typically require human intelligence.
AI engineers typically have a background in computer science, data science, mathematics, or related fields, often holding at least a bachelor's degree, with many having master's degrees or PhDs in specialized areas.
Overall, AI engineers play a critical role in advancing the capabilities of AI technologies and applying them to real-world challenges across various industries.

Stream ended.
`}
explanation={`
This code illustrates how to run a pipe agent with streaming response. Here's a step-by-step guide:

1. Create Summary Agent:
   - Calls the langbase.pipes.create() to create a 'summary-agent'.

2. Run the Pipe Agent:
   - Use the langbase.pipes.run() with the 'summary-agent'.
   - The agent processes the message and streams the response.

3. Handle the Stream:
   - Convert the stream to a stream runner.
   - Use event listeners to handle the stream events.
   - Write the content to the console.

4. Complete the Execution:
   - The Langbase SDK handles the stream.
   - Display the streaming responses to observe the agent's output.

`}
>


<LanguageContent language="typescript">
<CodeGroup title="Run Pipe Agent Streaming Example" exampleTitle="Run Pipe Agent Streaming Example">
```ts {{ title: 'index.ts' }}
import 'dotenv/config';
import {getRunner, Langbase} from 'langbase';

const langbase = new Langbase({
	apiKey: process.env.LANGBASE_API_KEY!,
});

async function main() {
	await createSummaryAgent();

	// Get readable stream
	const {stream, threadId, rawResponse} = await langbase.pipes.run({
		stream: true,
		name: 'summary-agent',
		rawResponse: true,
		messages: [
			{
				role: 'user', 
				content:  'Who is an AI Engineer?'
			}
		]
	});


	// Convert the stream to a stream runner.
	const runner = getRunner(stream);

	// Method 1: Using event listeners
	runner.on('connect', () => {
		console.log('Stream started.\n');
	});

	runner.on('content', content => {
		process.stdout.write(content);
	});

	runner.on('end', () => {
		console.log('\nStream ended.');
	});

	runner.on('error', error => {
		console.error('Error:', error);
	});
}

/**
 * Creates a summary agent pipe if it doesn't already exist.
 *
 * This function checks if a pipe with the name 'summary-agent' exists in the system.
 * If the pipe doesn't exist, it creates a new private pipe with a system message
 * configuring it as a helpful assistant.
 *
 * @async
 * @returns {Promise<void>} A promise that resolves when the operation is complete
 * @throws {Error} Logs any errors encountered during the creation process
 */
async function createSummaryAgent() {
    try {
        await langbase.pipes.create({
            name: 'summary-agent',
			upsert: true,
            status: 'private',
            messages: [
                {
                    role: 'system',
                    content: 'You are a helpful assistant that help users summarize text.',
                },
            ],
        });
    } catch (error) {
        console.error('Error creating summary agent:', error);
    }
}

main();

```
</CodeGroup>
</LanguageContent>

<LanguageContent language="python">
<CodeGroup title="Run Pipe Agent Streaming Example" exampleTitle="Run Pipe Agent Streaming Example">
```python {{ title: 'index.py' }}
import os
import asyncio
from langbase import Langbase, get_runner
from dotenv import load_dotenv

load_dotenv()

langbase = Langbase(api_key=os.getenv('LANGBASE_API_KEY'))

def main():
    create_summary_agent()

    # Get readable stream
    response = langbase.pipes.run(
        stream=True,
        name='summary-agent',
        raw_response=True,
        messages=[
            {
                'role': 'user',
                'content': 'Who is an AI Engineer?'
            }
        ]
    )

    runner = get_runner(response)
    print('Stream started \n\n')
    # Use text_generator() to stream content
    for content in runner.text_generator():
        print(content, end="", flush=True)

    print("\n\nStream ended!")  # Add a newline after first response

def create_summary_agent():
    """
    Creates a summary agent pipe if it doesn't already exist.

    This function checks if a pipe with the name 'summary-agent' exists in the system.
    If the pipe doesn't exist, it creates a new private pipe with a system message
    configuring it as a helpful assistant.

    Returns:
        None
    """
    try:
        langbase.pipes.create(
            name='summary-agent',
            upsert=True,
            status='private',
            messages=[
                {
                    'role': 'system',
                    'content': 'You are a helpful assistant that help users summarize text.',
                }
            ]
        )
    except Exception as error:
        print(f'Error creating summary agent: {error}')

if __name__ == '__main__':
   main()
```
</CodeGroup>
</LanguageContent>

</RunExample>
</LanguageProvider>
