import { generateMetadata } from '@/lib/generate-metadata';
import { LanguageProvider, SimpleLanguageToggle, LanguageContent } from '@/components/LanguageToggle';

export const metadata = generateMetadata({
    title: 'Run Pipe Agent',
    description: `An example of running a pipe agent.`,
    section: 'Examples',
    slug: '/examples/pipe-agent/run-pipe'
});


# Run Pipe Agent

This example demonstrates how to run a pipe agent with a user message.

---
<LanguageProvider defaultLanguage='typescript'>

<RunExample api="/docs/api/pipe"

	title="Run Pipe Agent Example"
	output={`"An AI Engineer is a professional who designs, develops, and implements artificial intelligence systems and applications. They work with machine learning algorithms, data processing, and software development to create intelligent solutions."`}
explanation={`
This code illustrates how to run a pipe agent using Langbase. Here's a step-by-step guide:

1. Create Pipe Agent:
   - Creates a new pipe agent with a system message

2. Run Pipe Agent:
   - Calls the langbase.pipes.run() with the 'summary-agent'
   - The agent processes the user message and generates a response

3. Execution:
   - The Langbase SDK executes the agent
   - Outputs the response to display the result of the agent's processing`}
>


<LanguageContent language="typescript">
<CodeGroup title="Run Pipe Agent Example" exampleTitle="Run Pipe Agent Example">
```ts {{ title: 'index.ts' }}
import 'dotenv/config';
import { Langbase } from 'langbase';

const langbase = new Langbase({
	apiKey: process.env.LANGBASE_API_KEY!,
});

async function main() {
	await createSummaryAgent();

	const response = await langbase.pipes.run({
		stream: false,
		name: 'summary-agent',
		messages: [
			{
				role: 'user',
				content: 'Who is an AI Engineer?',
			},
		],
	});

	console.log('response: ', response.completion);
}

/**
 * Creates a summary agent pipe if it doesn't already exist.
 *
 * This function checks if a pipe with the name 'summary-agent' exists in the system.
 * If the pipe doesn't exist, it creates a new private pipe with a system message
 * configuring it as a helpful assistant.
 *
 * @async
 * @returns {Promise<void>} A promise that resolves when the operation is complete
 * @throws {Error} Logs any errors encountered during the creation process
 */
async function createSummaryAgent() {
    try {
    	await langbase.pipes.create({
            name: 'summary-agent',
			upsert: true,
            status: 'private',
            messages: [
                {
                    role: 'system',
                    content: 'You are a helpful assistant that help users summarize text.',
                },
            ],
        });
    } catch (error) {
        console.error('Error creating summary agent:', error);
    }
}

main();
```
</CodeGroup>
</LanguageContent>

<LanguageContent language="python">
<CodeGroup title="Run Pipe Agent Example" exampleTitle="Run Pipe Agent Example">
```python {{ title: 'index.py' }}
import os
from langbase import Langbase
import json
from dotenv import load_dotenv

load_dotenv()

langbase = Langbase(api_key=os.getenv('LANGBASE_API_KEY'))

def main():
    create_summary_agent()

    response = langbase.pipes.run(
        stream=False,
        name='summary-agent',
        messages=[
            {
                'role': 'user',
                'content': 'Who is an AI Engineer?',
            }
        ]
    )

    print('response: ', response['completion'])

def create_summary_agent():
    """
    Creates a summary agent pipe if it doesn't already exist.

    This function checks if a pipe with the name 'summary-agent' exists in the system.
    If the pipe doesn't exist, it creates a new private pipe with a system message
    configuring it as a helpful assistant.

    Returns:
        None
    """
    try:
        langbase.pipes.create(
            name='summary-agent',
            upsert=True,
            status='private',
            messages=[
                {
                    'role': 'system',
                    'content': 'You are a helpful assistant that help users summarize text.',
                }
            ]
        )
    except Exception as error:
        print(f'Error creating summary agent: {error}')

if __name__ == '__main__':
    main()
```
</CodeGroup>
</LanguageContent>

</RunExample>
</LanguageProvider>


---
